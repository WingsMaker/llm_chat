<!DOCTYPE html>
<html lang="en-US" style="
		margin: 0;
		padding: 0;
		min-height: 100%;
		display: flex;
		flex-direction: column;
	">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>KH Bot</title>
	<link rel="icon" type="image/x-icon" href="kh.ico">
	<link rel="stylesheet" href="khbot.css">
	<script src="jquery-2.2.4.min.js"></script>	
</head>

<body style="width: 100%; margin: 0px; padding: 0px; display: flex; flex-direction: column; flex-grow: 1; --chatbot-body-text-size: 16px;" class="dark">
<div class="gradio-container gradio-container-4-17-0 svelte-182fdeq app" style="min-height: initial; flex-grow: 1;">
<div class="main svelte-182fdeq">  
<div class="wrap svelte-2mz9lo" style="min-height: 100%;">
<div class="contain svelte-2mz9lo" style="flex-grow: 1;">
<div id="component-2" class="svelte-vt1mxs gap" style="flex-grow: 1; min-width: min(0px, 100%);">
<div id="component-3" class="block svelte-90oupt padded hide-container" style="border-style: solid; overflow: visible; min-width: min(0px, 100%); border-width: var(--block-border-width);">
<div class="wrap center full svelte-1occ011 hide" style="position: absolute; padding: 0px;"></div> 
<div class="svelte-1ed2p3z">
<div class="prose  svelte-1yrv54" data-testid="markdown" dir="ltr"><span class="md svelte-1syupzx"><h1 style="text-align: center; margin-bottom: 1rem">LLM Chat</h1></span></div></div></div>
<div id="component-4" class="block svelte-90oupt padded hide-container" style="border-style: solid; overflow: visible; min-width: min(0px, 100%); border-width: var(--block-border-width);">
<div class="wrap center full svelte-1occ011 hide" style="position: absolute; padding: 0px;"></div> 
<div class="svelte-1ed2p3z">
<div class="prose  svelte-1yrv54" data-testid="markdown" dir="ltr"><span class="md svelte-1syupzx"><p>It supports Chinese text.</p></span></div></div></div>
<div id="component-0" class="block  svelte-90oupt" style="height: 300px; border-style: solid; overflow: hidden; min-width: min(160px, 100%); border-width: var(--block-border-width);"> 
<div class="wrapper svelte-nab2ao"><label for="" data-testid="block-label" class="svelte-1b6s6s"><span class="svelte-1b6s6s"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--carbon" width="100%" height="100%" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path fill="currentColor" d="M17.74 30L16 29l4-7h6a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h9v2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4h20a4 4 0 0 1 4 4v12a4 4 0 0 1-4 4h-4.84Z"></path><path fill="currentColor" d="M8 10h16v2H8zm0 6h10v2H8z"></path></svg></span> Chatbot</label>  
<div class="bubble-wrap svelte-1lcyrx4" role="log" aria-label="chatbot conversation" aria-live="polite">
<div class="message-wrap svelte-1lcyrx4 bubble-gap" id="message-panel"></div></div></div></div>
<div id="component-5" class="svelte-15lo0d8 stretch"><button class="sm secondary  svelte-cmf5ev" id="component-6"> Clear</button></div>
<div id="component-7" class="gr-group  svelte-iyf88w">
<div class="styler svelte-iyf88w" style="--block-radius: 0px; --block-border-width: 0px; --layout-gap: 1px; --form-gap-width: 1px; --button-border-width: 0px; --button-large-radius: 0px; --button-small-radius: 0px;">
<div id="component-8" class="svelte-15lo0d8 stretch">
<div id="component-1" class="block  svelte-90oupt" style="border-style: solid; overflow: hidden; flex-grow: 7; min-width: min(160px, 100%); border-width: var(--block-border-width);"> 
<label class="svelte-1f354aw">
<textarea data-testid="textbox" class="scroll-hide svelte-1f354aw" dir="ltr" id="user-input" placeholder="Ask me any question" rows="1" style="overflow-y: scroll; height: 42px;"></textarea></label></div>
<button class="lg primary  svelte-cmf5ev" id="component-9" style="flex-grow: 1; min-width: min(150px, 100%);"> Submit</button>
</div>
<div class="form svelte-sfqy0y hidden" style="flex-grow: 0; min-width: min(0px, 100%);">
<div id="component-12" class="block svelte-90oupt hidden padded" style="border-style: solid; overflow: hidden; min-width: min(160px, 100%); border-width: var(--block-border-width);"> 
<label class="svelte-1f354aw container"><span data-testid="block-info" class="svelte-1gfkn6j">Response</span>   
<textarea data-testid="textbox" class="scroll-hide svelte-1f354aw" dir="ltr" placeholder="" rows="1" style="overflow-y: scroll; height: 42px;">
</textarea></label></div></div></div></div>
<div class="gallery svelte-13hsdno">Powered by WingsMaker</div> </div></div> 
<footer class="svelte-2mz9lo"></footer></div>  
<div class="toast-wrap svelte-pu0yf1"></div></div> 
</div>
</body>

<script>
console.clear();
var messagePanel = document.getElementById("message-panel");
var userinput = document.getElementById("user-input");
userinput.value = "";

function post_message(question, answer) {
	if (answer.trim() == "") {
		messagePanel.innerHTML = "";
		return
	} else {
		messagePanel.innerHTML = "";
		var botMessage = document.createElement("div");
		var botQn = document.createElement("span");
		botQn.innerText = question;
		botMessage.appendChild(botQn);
		messagePanel.appendChild(botMessage);
		var botLn = document.createElement("span");
		botLn.innerHTML = "<br><br>";
		botMessage.appendChild(botLn);
		messagePanel.appendChild(botMessage);
		var botText = document.createElement("span");
		botText.innerText = answer;
		botMessage.appendChild(botText);
		messagePanel.appendChild(botMessage);
		messagePanel.scrollTop = messagePanel.scrollHeight;
		userinput.value = "";
	}
}

$('#component-6').click(function (e) {
	userinput.value = "";
	messagePanel.innerHTML = "";
});	

$('#component-9').click(function (e) {
	askbot_question();
});	

function askbot_question() {
	let prompt_text;
	let requestBody;
	let payload;
	let msg = "";
	var url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=..."; // replace ... with your api key
	var qn = userinput.value;
	if (qn == "") {
		alert("Please enter the prompt for the chat");
		return
	}
	prompt_text = {
		'text': encodeURIComponent(qn)
	}
	parts = {
		"parts": prompt_text
	}
	requestBody = {
		"contents": parts
	}
	payload = {
		method: 'POST',
		headers: {
		  'Content-Type': 'application/json'
		},
		body: JSON.stringify(requestBody)
	}
	return fetch(url, payload)
	.then(response => response.json())
	.then( content => content.candidates[0].content )
	.then(parts => parts.parts[0].text)
	.then((msg) => {
		msg = decodeURIComponent(msg);
		post_message(qn, msg)
	})
	.catch(error => {
		msg = "Error calling api : " + error;
		post_message(qn, msg)
	});	
}

</script>
</html>
